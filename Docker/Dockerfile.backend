FROM golang:1.22.2

WORKDIR /app

ARG HTTP_LISTEN_ADDRESS
ARG MONGO_DB_NAME
ARG MONGO_DB_URL
ARG JWT_SECRET
ARG MAX_ACTIVE_SESSIONS
ARG MODEL_ENDPOINT_URL

ENV HTTP_LISTEN_ADDRESS ${HTTP_LISTEN_ADDRESS}
ENV MONGO_DB_NAME ${MONGO_DB_NAME}
ENV MONGO_DB_URL ${MONGO_DB_URL}
ENV JWT_SECRET ${JWT_SECRET}
ENV MAX_ACTIVE_SESSIONS ${MAX_ACTIVE_SESSIONS}
ENV MODEL_ENDPOINT_URL ${MODEL_ENDPOINT_URL}

COPY go.mod go.sum ./
RUN go mod download
COPY . .

EXPOSE 8000
ENTRYPOINT ["make", "run"]